import { __awaiter } from "tslib";
import { useCallback, useEffect, useState } from "react";
export function usePersistedKVStore(key, defaultState, storageAdapter) {
    const [state, setState] = useState(null);
    useEffect(() => {
        void (() => __awaiter(this, void 0, void 0, function* () {
            const storedState = yield storageAdapter.get(key);
            if (storedState) {
                console.debug(`Restoring user settings for ${key}`);
                setState(JSON.parse(storedState));
            }
        }))();
    }, [key, storageAdapter]);
    const setLocalStorageState = useCallback((newState) => __awaiter(this, void 0, void 0, function* () {
        const changed = state !== newState;
        if (!changed) {
            return;
        }
        if (newState === null) {
            yield storageAdapter.remove(key);
            setState(defaultState);
        }
        else {
            yield storageAdapter.set(key, JSON.stringify(newState));
            setState(newState);
        }
    }), [state, defaultState, storageAdapter, key]);
    return [state !== null && state !== void 0 ? state : defaultState, setLocalStorageState];
}
//# sourceMappingURL=usePersistedKVStore.js.map