import { __rest } from "tslib";
import React from "react";
import { createContainer, useContainer } from "unstated-next";
import { ErrorLevel } from "./error";
import { DEFAULT_WALLET_PROVIDERS } from "./providers";
import { LOCAL_STORAGE_ADAPTER } from "./storage";
import { useConnectionInternal } from "./utils/useConnectionInternal";
import { useProviderInternal } from "./utils/useProviderInternal";
import { useWalletInternal } from "./utils/useWalletInternal";
const defaultOnConnect = (wallet, provider) => {
    console.log(`Connected to ${provider.name} wallet: ${wallet.publicKey.toString()}`);
};
const defaultOnDisconnect = (_wallet, provider) => {
    console.log(`Disconnected from ${provider.name} wallet`);
};
const defaultOnError = (err) => {
    if (err.level === ErrorLevel.WARN) {
        console.warn(err);
    }
    else {
        console.error(err);
    }
};
/**
 * Provides Solana.
 * @returns
 */
const useSolanaInternal = (_a = {}) => {
    var { onConnect = defaultOnConnect, onDisconnect = defaultOnDisconnect, onError = defaultOnError, storageAdapter = LOCAL_STORAGE_ADAPTER, walletProviders = DEFAULT_WALLET_PROVIDERS } = _a, connectionArgs = __rest(_a, ["onConnect", "onDisconnect", "onError", "storageAdapter", "walletProviders"]);
    const connectionCtx = useConnectionInternal(Object.assign(Object.assign({}, connectionArgs), { storageAdapter }));
    const { network, endpoint } = connectionCtx;
    const walletCtx = useWalletInternal({
        onConnect,
        onDisconnect,
        network,
        endpoint,
        onError,
        storageAdapter,
        walletProviders,
    });
    const providerCtx = useProviderInternal({
        connection: connectionCtx.connection,
        wallet: walletCtx.wallet,
    });
    return Object.assign(Object.assign(Object.assign({}, walletCtx), connectionCtx), providerCtx);
};
const Solana = createContainer(useSolanaInternal);
/**
 * Provides a Solana SDK.
 *
 * Note: ensure that `onConnect` and `onDisconnect` are wrapped in useCallback or are
 * statically defined, otherwise the wallet will keep re-rendering.
 * @returns
 */
export const SolanaProvider = (_a) => {
    var { children } = _a, args = __rest(_a, ["children"]);
    return (React.createElement(Solana.Provider, { initialState: args }, children));
};
/**
 * Fetches the loaded Solana SDK.
 */
export const useSolana = () => useContainer(Solana);
//# sourceMappingURL=context.js.map