{"version":3,"file":"errors.js","sourceRoot":"","sources":["../../src/errors.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Idl } from \"@project-serum/anchor\";\nimport type { PublicKey, SendTransactionError } from \"@solana/web3.js\";\n\nimport {\n  REWARD_DISTRIBUTOR_ADDRESS,\n  REWARD_DISTRIBUTOR_IDL,\n} from \"./programs/rewardDistributor\";\nimport { STAKE_POOL_ADDRESS, STAKE_POOL_IDL } from \"./programs/stakePool\";\n\ntype ErrorCode = {\n  code: string;\n  message: string;\n};\n\nexport const nativeErrors: ErrorCode[] = [\n  {\n    code: \"100\",\n    message: \"InstructionMissing: 8 byte instruction identifier not provided\",\n  },\n  {\n    code: \"101\",\n    message:\n      \"InstructionFallbackNotFound: Fallback functions are not supported\",\n  },\n  {\n    code: \"102\",\n    message:\n      \"InstructionDidNotDeserialize: The program could not deserialize the given instruction\",\n  },\n  {\n    code: \"103\",\n    message:\n      \"InstructionDidNotSerialize: The program could not serialize the given instruction\",\n  },\n  {\n    code: \"1000\",\n    message:\n      \"IdlInstructionStub: The program was compiled without idl instructions\",\n  },\n  {\n    code: \"1001\",\n    message:\n      \"IdlInstructionInvalidProgram: Invalid program given to the IDL instruction\",\n  },\n  { code: \"2000\", message: \"ConstraintMut: A mut constraint was violated\" },\n  {\n    code: \"2001\",\n    message: \"ConstraintHasOne: A has one constraint was violated\",\n  },\n  {\n    code: \"2002\",\n    message: \"ConstraintSigner: A signer constraint as violated\",\n  },\n  { code: \"2003\", message: \"ConstraintRaw: A raw constraint was violated\" },\n  {\n    code: \"2004\",\n    message: \"ConstraintOwner: An owner constraint was violated\",\n  },\n  {\n    code: \"2005\",\n    message: \"ConstraintRentExempt: A rent exemption constraint was violated\",\n  },\n  {\n    code: \"2006\",\n    message: \"ConstraintSeeds: A seeds constraint was violated\",\n  },\n  {\n    code: \"2007\",\n    message: \"ConstraintExecutable: An executable constraint was violated\",\n  },\n  {\n    code: \"2008\",\n    message: \"ConstraintState: A state constraint was violated\",\n  },\n  {\n    code: \"2009\",\n    message: \"ConstraintAssociated: An associated constraint was violated\",\n  },\n  {\n    code: \"2010\",\n    message:\n      \"ConstraintAssociatedInit: An associated init constraint was violated\",\n  },\n  {\n    code: \"2011\",\n    message: \"ConstraintClose: A close constraint was violated\",\n  },\n  {\n    code: \"2012\",\n    message: \"ConstraintAddress: An address constraint was violated\",\n  },\n  {\n    code: \"2013\",\n    message: \"ConstraintZero: Expected zero account discriminant\",\n  },\n  {\n    code: \"2014\",\n    message: \"ConstraintTokenMint: A token mint constraint was violated\",\n  },\n  {\n    code: \"2015\",\n    message: \"ConstraintTokenOwner: A token owner constraint was violated\",\n  },\n  {\n    code: \"2016\",\n    message:\n      \"ConstraintMintMintAuthority: A mint mint authority constraint was violated\",\n  },\n  {\n    code: \"2017\",\n    message:\n      \"ConstraintMintFreezeAuthority: A mint freeze authority constraint was violated\",\n  },\n  {\n    code: \"2018\",\n    message: \"ConstraintMintDecimals: A mint decimals constraint was violated\",\n  },\n  {\n    code: \"2019\",\n    message: \"ConstraintSpace: A space constraint was violated\",\n  },\n  {\n    code: \"3000\",\n    message:\n      \"AccountDiscriminatorAlreadySet: The account discriminator was already set on this account\",\n  },\n  {\n    code: \"3001\",\n    message:\n      \"AccountDiscriminatorNotFound: No 8 byte discriminator was found on the account\",\n  },\n  {\n    code: \"3002\",\n    message:\n      \"AccountDiscriminatorMismatch: 8 byte discriminator did not match what was expected\",\n  },\n  {\n    code: \"3003\",\n    message: \"AccountDidNotDeserialize: Failed to deserialize the account\",\n  },\n  {\n    code: \"3004\",\n    message: \"AccountDidNotSerialize: Failed to serialize the account\",\n  },\n  {\n    code: \"3005\",\n    message:\n      \"AccountNotEnoughKeys: Not enough account keys given to the instruction\",\n  },\n  {\n    code: \"3006\",\n    message: \"AccountNotMutable: The given account is not mutable\",\n  },\n  {\n    code: \"3007\",\n    message:\n      \"AccountNotProgramOwned: The given account is not owned by the executing program\",\n  },\n  {\n    code: \"3008\",\n    message: \"InvalidProgramId: Program ID was not as expected\",\n  },\n  {\n    code: \"3009\",\n    message: \"InvalidProgramExecutable: Program account is not executable\",\n  },\n  {\n    code: \"3010\",\n    message: \"AccountNotSigner: The given account did not sign\",\n  },\n  {\n    code: \"3011\",\n    message:\n      \"AccountNotSystemOwned: The given account is not owned by the system program\",\n  },\n  {\n    code: \"3012\",\n    message:\n      \"AccountNotInitialized: The program expected this account to be already initialized\",\n  },\n  {\n    code: \"3013\",\n    message:\n      \"AccountNotProgramData: The given account is not a program data account\",\n  },\n  {\n    code: \"3014\",\n    message:\n      \"AccountNotAssociatedTokenAccount: The given account is not the associated token account\",\n  },\n  {\n    code: \"4000\",\n    message:\n      \"StateInvalidAddress: The given state account does not have the correct address\",\n  },\n  {\n    code: \"5000\",\n    message:\n      \"Deprecated: The API being used is deprecated and should no longer be used\",\n  },\n];\n\nexport const handleError = (\n  e: any,\n  fallBackMessage = \"Transaction failed\",\n  // programIdls in priority order\n  programIdls: { idl: Idl; programId: PublicKey }[] = [\n    { programId: STAKE_POOL_ADDRESS, idl: STAKE_POOL_IDL },\n    { programId: REWARD_DISTRIBUTOR_ADDRESS, idl: REWARD_DISTRIBUTOR_IDL },\n  ]\n): string => {\n  const hex = (e as SendTransactionError).message.split(\" \").at(-1);\n  const dec = parseInt(hex || \"\", 16);\n  const logs =\n    (e as SendTransactionError).logs ?? [\n      (e as SendTransactionError).message,\n    ] ?? [(e as Error).toString()] ??\n    [];\n\n  const matchedErrors: { programMatch?: boolean; errorMatch?: string }[] = dec\n    ? [\n        ...programIdls.map(({ idl, programId }) => ({\n          // match program on any log that includes programId and 'failed'\n          programMatch: logs?.some(\n            (l) => l.includes(programId.toString()) && l.includes(\"failed\")\n          ),\n          // match error with decimal\n          errorMatch: idl.errors?.find((err) => err.code === dec)?.msg,\n        })),\n        {\n          // match native error with decimal\n          errorMatch: nativeErrors.find((err) => err.code === dec.toString())\n            ?.message,\n        },\n      ]\n    : [\n        ...programIdls.map(({ idl, programId }) => ({\n          // match program on any log that includes programId and 'failed'\n          programMatch: logs?.some(\n            (l) => l.includes(programId.toString()) && l.includes(\"failed\")\n          ),\n          errorMatch: idl.errors?.find(\n            (err) =>\n              // message includes error\n              (e as SendTransactionError).message.includes(\n                err.code.toString()\n              ) ||\n              // toString includes error\n              (e as Error).toString().includes(err.code.toString()) ||\n              // any log includes error\n              (e as SendTransactionError).logs?.some((l) =>\n                l.toString().includes(err.code.toString())\n              )\n          )?.msg,\n        })),\n        {\n          errorMatch: nativeErrors.find(\n            (err) =>\n              // message includes error\n              (e as SendTransactionError).message.includes(err.code) ||\n              // toString includes error\n              (e as Error).toString().includes(err.code) ||\n              // any log includes error\n              (e as SendTransactionError).logs?.some((l) =>\n                l.toString().includes(err.code)\n              )\n          )?.message,\n        },\n      ];\n\n  return (\n    matchedErrors.find((e) => e.programMatch && e.errorMatch)?.errorMatch ||\n    matchedErrors.find((e) => e.errorMatch)?.errorMatch ||\n    fallBackMessage\n  );\n};\n"]}