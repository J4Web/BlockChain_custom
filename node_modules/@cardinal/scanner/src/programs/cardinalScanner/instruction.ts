import { AnchorProvider, Program } from "@project-serum/anchor";
import type { Wallet } from "@saberhq/solana-contrib";
import type {
  Connection,
  PublicKey,
  TransactionInstruction,
} from "@solana/web3.js";

import type { SCANNER_PROGRAM } from "./constants";
import { SCANNER_ADDRESS, SCANNER_IDL } from "./constants";

export const scan = (
  connection: Connection,
  wallet: Wallet,
  additionalSigner: PublicKey
): TransactionInstruction => {
  const provider = new AnchorProvider(connection, wallet, {});
  const scannerProgram = new Program<SCANNER_PROGRAM>(
    SCANNER_IDL,
    SCANNER_ADDRESS,
    provider
  );
  return scannerProgram.instruction.scan({
    accounts: {
      user: wallet.publicKey,
      scanner: additionalSigner,
    },
  });
};
