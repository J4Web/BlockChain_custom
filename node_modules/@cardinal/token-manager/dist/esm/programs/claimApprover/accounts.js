import { __awaiter } from "tslib";
import { AnchorProvider, BorshAccountsCoder, Program, } from "@project-serum/anchor";
import { CLAIM_APPROVER_ADDRESS, CLAIM_APPROVER_IDL } from "./constants";
import { findClaimApproverAddress } from "./pda";
// TODO fix types
export const getClaimApprover = (connection, tokenManagerId) => __awaiter(void 0, void 0, void 0, function* () {
    // eslint-disable-next-line @typescript-eslint/ban-ts-comment
    // @ts-ignore
    const provider = new AnchorProvider(connection, null, {});
    const claimApproverProgram = new Program(CLAIM_APPROVER_IDL, CLAIM_APPROVER_ADDRESS, provider);
    const [claimApproverId] = yield findClaimApproverAddress(tokenManagerId);
    const parsed = yield claimApproverProgram.account.paidClaimApprover.fetch(claimApproverId);
    return {
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        parsed,
        pubkey: claimApproverId,
    };
});
export const getClaimApprovers = (connection, claimApproverIds) => __awaiter(void 0, void 0, void 0, function* () {
    // eslint-disable-next-line @typescript-eslint/ban-ts-comment
    // @ts-ignore
    const provider = new AnchorProvider(connection, null, {});
    const claimApproverProgram = new Program(CLAIM_APPROVER_IDL, CLAIM_APPROVER_ADDRESS, provider);
    // eslint-disable-next-line @typescript-eslint/ban-ts-comment
    // @ts-ignore
    let claimApprovers = [];
    try {
        claimApprovers =
            yield claimApproverProgram.account.paidClaimApprover.fetchMultiple(claimApproverIds);
    }
    catch (e) {
        console.log(e);
    }
    // eslint-disable-next-line @typescript-eslint/ban-ts-comment
    // @ts-ignore
    return claimApprovers.map((tm, i) => ({
        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
        parsed: tm,
        pubkey: claimApproverIds[i],
    }));
});
export const getAllClaimApprovers = (connection) => __awaiter(void 0, void 0, void 0, function* () {
    const programAccounts = yield connection.getProgramAccounts(CLAIM_APPROVER_ADDRESS);
    const claimApprovers = [];
    const coder = new BorshAccountsCoder(CLAIM_APPROVER_IDL);
    programAccounts.forEach((account) => {
        try {
            const timeInvalidatorData = coder.decode("paidClaimApprover", account.account.data);
            claimApprovers.push(Object.assign(Object.assign({}, account), { parsed: timeInvalidatorData }));
        }
        catch (e) {
            console.log(`Failed to decode claim approver data`);
        }
    });
    return claimApprovers;
});
//# sourceMappingURL=accounts.js.map