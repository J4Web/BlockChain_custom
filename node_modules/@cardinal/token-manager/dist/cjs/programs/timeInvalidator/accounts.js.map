{"version":3,"file":"accounts.js","sourceRoot":"","sources":["../../../../src/programs/timeInvalidator/accounts.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  AnchorProvider,\n  BN,\n  BorshAccountsCoder,\n  Program,\n} from \"@project-serum/anchor\";\nimport type { Connection, PublicKey } from \"@solana/web3.js\";\n\nimport type { AccountData } from \"../../utils\";\nimport type {\n  TIME_INVALIDATOR_PROGRAM,\n  TimeInvalidatorData,\n} from \"./constants\";\nimport { TIME_INVALIDATOR_ADDRESS, TIME_INVALIDATOR_IDL } from \"./constants\";\n\n// TODO fix types\nexport const getTimeInvalidator = async (\n  connection: Connection,\n  timeInvalidatorId: PublicKey\n): Promise<AccountData<TimeInvalidatorData>> => {\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  const provider = new AnchorProvider(connection, null, {});\n  const timeInvalidatorProgram = new Program<TIME_INVALIDATOR_PROGRAM>(\n    TIME_INVALIDATOR_IDL,\n    TIME_INVALIDATOR_ADDRESS,\n    provider\n  );\n\n  const parsed = await timeInvalidatorProgram.account.timeInvalidator.fetch(\n    timeInvalidatorId\n  );\n  return {\n    parsed,\n    pubkey: timeInvalidatorId,\n  };\n};\n\nexport const getTimeInvalidators = async (\n  connection: Connection,\n  timeInvalidatorIds: PublicKey[]\n): Promise<AccountData<TimeInvalidatorData>[]> => {\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  const provider = new AnchorProvider(connection, null, {});\n  const timeInvalidatorProgram = new Program<TIME_INVALIDATOR_PROGRAM>(\n    TIME_INVALIDATOR_IDL,\n    TIME_INVALIDATOR_ADDRESS,\n    provider\n  );\n\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  let timeInvalidators = [];\n  try {\n    timeInvalidators =\n      await timeInvalidatorProgram.account.timeInvalidator.fetchMultiple(\n        timeInvalidatorIds\n      );\n  } catch (e) {\n    console.log(e);\n  }\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  return timeInvalidators.map((tm, i) => ({\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n    parsed: tm,\n    pubkey: timeInvalidatorIds[i],\n  }));\n};\n\nexport const getExpiredTimeInvalidators = async (\n  connection: Connection\n): Promise<AccountData<TimeInvalidatorData>[]> => {\n  const programAccounts = await connection.getProgramAccounts(\n    TIME_INVALIDATOR_ADDRESS\n  );\n\n  const expiredTimeInvalidators: AccountData<TimeInvalidatorData>[] = [];\n  const coder = new BorshAccountsCoder(TIME_INVALIDATOR_IDL);\n  programAccounts.forEach((account) => {\n    try {\n      const timeInvalidatorData: TimeInvalidatorData = coder.decode(\n        \"timeInvalidator\",\n        account.account.data\n      );\n      if (timeInvalidatorData.expiration?.lte(new BN(Date.now() / 1000))) {\n        expiredTimeInvalidators.push({\n          ...account,\n          parsed: timeInvalidatorData,\n        });\n      }\n    } catch (e) {\n      console.log(`Failed to decode time invalidator data`);\n    }\n  });\n  return expiredTimeInvalidators;\n};\n\nexport const getAllTimeInvalidators = async (\n  connection: Connection\n): Promise<AccountData<TimeInvalidatorData>[]> => {\n  const programAccounts = await connection.getProgramAccounts(\n    TIME_INVALIDATOR_ADDRESS\n  );\n\n  const expiredTimeInvalidators: AccountData<TimeInvalidatorData>[] = [];\n  const coder = new BorshAccountsCoder(TIME_INVALIDATOR_IDL);\n  programAccounts.forEach((account) => {\n    try {\n      const timeInvalidatorData: TimeInvalidatorData = coder.decode(\n        \"timeInvalidator\",\n        account.account.data\n      );\n      expiredTimeInvalidators.push({\n        ...account,\n        parsed: timeInvalidatorData,\n      });\n    } catch (e) {\n      console.log(`Failed to decode time invalidator data`);\n    }\n  });\n  return expiredTimeInvalidators;\n};\n"]}