"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useWalletIdentity = exports.WalletIdentityProvider = exports.WalletIdentityContext = void 0;
const tslib_1 = require("tslib");
const jsx_runtime_1 = require("@emotion/react/jsx-runtime");
const react_1 = tslib_1.__importStar(require("react"));
const react_query_1 = require("react-query");
const devtools_1 = require("react-query/devtools");
const __1 = require("..");
const modal_1 = require("../modal");
const transactions_1 = require("../utils/transactions");
const DEBUG = false;
exports.WalletIdentityContext = react_1.default.createContext(null);
const WalletIdentityProvider = ({ appName, appTwitter, children, }) => {
    const [wallet, setWallet] = (0, react_1.useState)();
    const [connection, setConnection] = (0, react_1.useState)();
    const [secondaryConnection, setSecondaryConnection] = (0, react_1.useState)();
    const [showManageDefault, setShowManageDefault] = (0, react_1.useState)(false);
    const [cluster, setCluster] = (0, react_1.useState)(undefined);
    const [dev, setDev] = (0, react_1.useState)(undefined);
    const [onClose, setOnClose] = (0, react_1.useState)();
    const [showIdentityModal, setShowIdentityModal] = (0, react_1.useState)(false);
    const [handle, setHandle] = (0, react_1.useState)(undefined);
    return ((0, jsx_runtime_1.jsx)(exports.WalletIdentityContext.Provider, Object.assign({ value: {
            show: ({ wallet, connection, cluster, secondaryConnection, dev, onClose, showManage: showManageDefault, }) => {
                setWallet(wallet);
                setConnection(connection);
                setCluster(cluster);
                setSecondaryConnection(secondaryConnection);
                setDev(dev);
                onClose && setOnClose(() => onClose);
                setShowIdentityModal(true);
                setShowManageDefault(showManageDefault || false);
            },
            handle,
            wallet,
            connection,
            cluster,
            dev,
            showIdentityModal,
        } }, { children: (0, jsx_runtime_1.jsxs)(react_query_1.QueryClientProvider, Object.assign({ client: new react_query_1.QueryClient() }, { children: [(0, jsx_runtime_1.jsx)(modal_1.Modal, Object.assign({ isOpen: showIdentityModal, onDismiss: () => {
                        setShowIdentityModal(false);
                        onClose && onClose();
                    }, darkenOverlay: true }, { children: (0, jsx_runtime_1.jsx)(__1.ClaimCard, { dev: dev, cluster: cluster, wallet: wallet, connection: connection, secondaryConnection: secondaryConnection, appName: appName, appTwitter: appTwitter, showManage: showManageDefault, onComplete: (handle) => {
                            setHandle(handle);
                            (0, transactions_1.withSleep)(() => {
                                setShowIdentityModal(false);
                                onClose && onClose();
                            }, 1000);
                        } }) })), children, DEBUG && (0, jsx_runtime_1.jsx)(devtools_1.ReactQueryDevtools, { initialIsOpen: false })] })) })));
};
exports.WalletIdentityProvider = WalletIdentityProvider;
const useWalletIdentity = () => {
    const identity = (0, react_1.useContext)(exports.WalletIdentityContext);
    if (!identity) {
        throw new Error('Not in WalletIdentity context');
    }
    return identity;
};
exports.useWalletIdentity = useWalletIdentity;
//# sourceMappingURL=WalletIdentityProvider.js.map