"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getOwner = exports.findAta = exports.tryGetAccount = void 0;
const tslib_1 = require("tslib");
const splToken = tslib_1.__importStar(require("@solana/spl-token"));
const web3 = tslib_1.__importStar(require("@solana/web3.js"));
/**
 * Tries to get account based on function fn
 * Return null if account doesn't exist
 * @param fn
 * @returns
 */
function tryGetAccount(fn) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        try {
            return yield fn();
        }
        catch (_a) {
            return null;
        }
    });
}
exports.tryGetAccount = tryGetAccount;
/**
 * Utility function to get associated token address
 * @param mint
 * @param owner
 * @param allowOwnerOffCurve
 * @returns
 */
function findAta(mint, owner, allowOwnerOffCurve) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        return splToken.Token.getAssociatedTokenAddress(splToken.ASSOCIATED_TOKEN_PROGRAM_ID, splToken.TOKEN_PROGRAM_ID, mint, owner, allowOwnerOffCurve);
    });
}
exports.findAta = findAta;
/**
 * Gets owner of mintId
 * @param connection
 * @param mintId
 * @returns
 */
const getOwner = (connection, mintId) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
    var _a, _b;
    const mint = new web3.PublicKey(mintId);
    const largestHolders = yield connection.getTokenLargestAccounts(mint);
    const certificateMintToken = new splToken.Token(connection, mint, splToken.TOKEN_PROGRAM_ID, 
    // not used
    web3.Keypair.generate());
    const largestTokenAccount = ((_a = largestHolders === null || largestHolders === void 0 ? void 0 : largestHolders.value[0]) === null || _a === void 0 ? void 0 : _a.address) &&
        (yield certificateMintToken.getAccountInfo((_b = largestHolders === null || largestHolders === void 0 ? void 0 : largestHolders.value[0]) === null || _b === void 0 ? void 0 : _b.address));
    return largestTokenAccount === null || largestTokenAccount === void 0 ? void 0 : largestTokenAccount.owner;
});
exports.getOwner = getOwner;
//# sourceMappingURL=accounts.js.map